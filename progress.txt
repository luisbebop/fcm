# FCM Implementation Progress

## Completed Tasks

### Task 1: Project Structure and CLI Parsing
- Created Cargo.toml with dependencies (clap, serde, serde_json, rand, tiny_http, ureq)
- Created src/main.rs with full CLI parsing using clap derive
- Commands implemented: create, ls, ssh, stop, start, destroy, daemon
- Created stub modules: client.rs, daemon.rs, vm.rs, firecracker.rs, network.rs, caddy.rs
- All modules compile, tests pass
- Commit: 4e93d71

### Task 2: VM Config Types and Name Generation
- Implemented VmConfig struct with id, name, ip, state, expose fields
- Implemented VmState enum (Running, Stopped)
- Implemented ExposeConfig struct for port/domain exposure
- Added word lists (ADJECTIVES, NOUNS) per PRD spec
- Implemented generate_id() for 8-char alphanumeric IDs
- Implemented random_name() for adjective-noun combinations
- Added helper methods: dir(), config_path(), rootfs_path(), socket_path(), pid_path()
- Added save() and load() methods for config persistence
- Added list_vms() and find_vm() functions for VM discovery
- Added 9 unit tests covering all functionality
- Commit: a3c8601

### Task 3: Daemon HTTP Server
- Implemented HTTP server on localhost:7777 using tiny_http
- Token-based authentication with Bearer header validation
- Auto-generates 32-char token on first run, saves to /var/lib/firecracker/.token
- Token file has restricted permissions (0600)
- REST API routes implemented:
  - POST /vms - create VM (saves config to disk)
  - GET /vms - list all VMs
  - GET /vms/{id} - get VM details
  - GET /vms/{id}/ssh - get SSH connection info
  - POST /vms/{id}/stop - stop VM
  - POST /vms/{id}/start - start VM
  - DELETE /vms/{id} - destroy VM (removes directory)
- JSON request/response handling with proper error responses
- Root check warning on startup
- Added 7 unit tests for token generation, routing, and serialization
- Added libc dependency for euid check
- Commit: 614b86b

### Task 4: Client HTTP Requests with Token Auth
- Implemented HTTP client using ureq with json feature
- Token loading from FCM_TOKEN env var or ~/.fcm-token file
- Added dirs dependency for cross-platform home directory detection
- make_request() helper for authenticated requests to daemon
- Implemented all client functions:
  - create_vm() - POST /vms with name/expose options
  - list_vms() - GET /vms with formatted table output
  - ssh_vm() - GET /vms/{id}/ssh then exec ssh command
  - stop_vm() - POST /vms/{id}/stop
  - start_vm() - POST /vms/{id}/start
  - destroy_vm() - DELETE /vms/{id}
- Proper error handling for connection failures and HTTP errors
- Added 8 unit tests for serialization, deserialization, and token loading
- Commit: 2c8a1c9

### Task 5: Firecracker API over Unix Socket
- Implemented FirecrackerClient struct for unix socket communication
- HTTP over unix socket with request/response parsing
- Request types: BootSource, Drive, MachineConfig, NetworkInterface
- Action types: InstanceStart, SendCtrlAltDel for VM control
- API methods:
  - set_boot_source() - configure kernel and boot args
  - set_drive() - configure rootfs drive
  - set_machine_config() - configure vcpu count and memory
  - set_network_interface() - configure network interface with MAC
  - start_instance() - start the VM
  - send_ctrl_alt_del() - graceful shutdown
  - get_instance_info() - get VM status
  - is_available() - check socket connectivity
- Helper functions: generate_mac(), build_boot_args()
- FirecrackerError enum with Display impl for error handling
- Added 17 unit tests for serialization, parsing, and helpers
- Commit: f505e61

### Task 6: Network Setup (Tap Devices and IP Allocation)
- Implemented NetworkError enum with Display impl for error handling
- Network constants: GATEWAY (172.16.0.1), SUBNET_MASK, SUBNET_CIDR
- IP allocation from pool (172.16.0.50-254)
- Tap device management:
  - tap_name() - generates tap device name (tap_<vm_id>)
  - create_tap() - creates tap device, brings it up, adds to bridge
  - delete_tap() - removes tap device
- Network bridge setup:
  - setup_network() - creates fcm0 bridge, assigns gateway IP, enables forwarding
  - cleanup_network() - removes bridge and nftables rules
- nftables masquerade setup for NAT (allows VMs to access internet)
- Helper functions:
  - allocate_ip() - finds first available IP in pool
  - get_used_ips() - gets IPs currently in use by VMs
  - parse_last_octet() - parses last octet from IP string
  - is_valid_vm_ip() - validates IP is in VM range
- Added 12 unit tests covering all functionality
- Commit: 670e9c5

### Task 7: Caddy Config Management
- Implemented CaddyError enum with Display impl for error handling
- Added CADDYFILE_PATH constant (/etc/caddy/Caddyfile)
- Server IP detection:
  - get_server_ip() - fetches public IP via ifconfig.me or icanhazip.com
  - is_valid_ipv4() - validates IPv4 address format
- Domain generation:
  - generate_domain() - creates sslip.io domain (e.g., myvm.64-34-93-45.sslip.io)
- Caddyfile management:
  - add_site() / add_site_to_file() - adds reverse proxy block to Caddyfile
  - remove_site() / remove_site_from_file() - removes managed block from Caddyfile
  - generate_caddy_block() - generates Caddy config block with fcm-managed marker
  - remove_site_block() - parses and removes site block using brace counting
  - update_site_in_file() - updates existing site configuration
- Caddy control:
  - reload() - reloads Caddy via systemctl or caddy CLI
  - is_running() - checks if Caddy service is active
  - validate() / validate_file() - validates Caddyfile syntax
- Added tempfile dev-dependency for tests
- Added 12 unit tests covering all functionality
- Commit: 44ac827

### Task 8: VM Lifecycle Management
- Implemented VmError enum that unifies errors from all modules (IO, Network, Firecracker, Caddy)
- Added From implementations for error conversion from all module error types
- Added constants: KERNEL_PATH, BASE_ROOTFS_PATH, DEFAULT_VCPU_COUNT (1), DEFAULT_MEM_SIZE_MIB (512)
- Implemented create_vm():
  - Checks for required kernel and rootfs files
  - Allocates IP from pool via network module
  - Creates VM directory and copies rootfs with sparse support (cp --sparse=always)
  - Creates tap device and adds to bridge
  - Spawns firecracker process
  - Waits for socket availability with configurable timeout
  - Configures boot source, drive, machine config, network interface via Firecracker API
  - Starts the VM instance
  - Configures Caddy if port exposure requested
  - Proper cleanup on any failure (removes directory, tap device, kills process)
- Implemented stop_vm():
  - Validates VM exists and is running
  - Attempts graceful shutdown via Ctrl+Alt+Del
  - Kills firecracker process (SIGTERM then SIGKILL)
  - Deletes tap device
  - Updates VM state to Stopped
- Implemented start_vm():
  - Validates VM exists and is stopped
  - Creates tap device
  - Spawns and configures new firecracker process
  - Starts the VM instance
  - Updates VM state to Running
- Implemented destroy_vm():
  - Stops VM if running (graceful then forced)
  - Deletes tap device
  - Removes Caddy site configuration if exposed
  - Removes VM directory completely
- Helper functions:
  - spawn_firecracker() - spawns firecracker process with API socket
  - kill_firecracker() - kills process by PID from file
  - wait_for_socket() - polls for socket availability with timeout
  - cleanup_failed_vm() - cleanup helper for create failures
  - is_vm_running() - checks if firecracker process is alive
  - sync_vm_state() - syncs config state with actual process state
- Added 6 unit tests for VmError and constants
- Commit: f83ce1e

### Task 9: Wire Daemon Handlers to VM Lifecycle Functions
- Updated daemon HTTP handlers to use actual VM lifecycle functions from vm module
- handle_create_vm() now calls vm::create_vm() instead of placeholder config creation
- handle_stop_vm() now calls vm::stop_vm() instead of just updating config state
- handle_start_vm() now calls vm::start_vm() instead of just updating config state
- handle_destroy_vm() now calls vm::destroy_vm() instead of just removing directory
- Added proper HTTP error mapping based on VmError variants:
  - VmError::NotFound -> 404
  - VmError::InvalidState -> 400
  - VmError::ResourceNotAvailable -> 503
  - Other errors -> 500
- Imported VmError type for error handling
- All 69 tests pass
- Commit: d3b4b17

### Task 10: Integrate Network Setup on Daemon Startup
- Added network module import to daemon.rs
- Call network::setup_network() in daemon's run() function before starting HTTP server
- Network setup creates fcm0 bridge, assigns 172.16.0.1 gateway IP, enables IP forwarding
- Sets up nftables masquerade for VM outbound traffic (NAT)
- Errors are handled gracefully with warning messages (doesn't block daemon startup)
- All 69 tests pass
- Commit: bf535d6

### Task 11: Base Rootfs Image Build Scripts
- Created rootfs/ directory for base image build files
- Created Dockerfile as specified in PRD:
  - Based on alpine:edge
  - Installs openssh, ruby, ruby-bundler, python3, py3-pip, curl, bash, iproute2
  - Configures SSH with root login enabled (root:root password)
  - Copies init script to /sbin/init
- Created init script for VM initialization:
  - Mounts essential filesystems (proc, sysfs, devtmpfs, devpts)
  - Creates necessary device nodes if missing
  - Sets hostname from kernel cmdline if available
  - Configures DNS (8.8.8.8, 8.8.4.4)
  - Starts sshd
  - Runs placeholder HTTP server on port 8000 using python3
  - Keeps init process running with bash login shell
- Created build.sh script to automate rootfs creation:
  - Builds Docker image from Dockerfile
  - Exports container filesystem to tarball
  - Creates sparse ext4 filesystem image (1GB apparent, ~400MB actual)
  - Extracts rootfs tarball into ext4 image
  - Outputs to /var/lib/firecracker/base-rootfs.img by default
- All 69 tests pass
- Commit: 30c52ca

### Task 12: Fix Init Script Hostname Parsing
- Fixed hostname parsing in rootfs/init script
- Init script was incorrectly looking for `hostname=` kernel argument
- Boot args actually pass hostname as 5th field of `ip=` parameter
- Format: `ip=<client-ip>:<server-ip>:<gw-ip>:<netmask>:<hostname>:<device>:<autoconf>`
- Example: `ip=172.16.0.50::172.16.0.1:255.255.255.0:myvm:eth0:on`
- Updated parsing logic to extract hostname from ip= parameter correctly
- Also fixed comment that incorrectly showed empty hostname field
- All 69 tests pass
- Commit: 8ac22cd

### Task 13: Fix VM Boot with Dropbear SSH and Entropy Initialization
- Fixed multiple issues preventing VMs from booting and running SSH correctly
- Updated src/firecracker.rs build_boot_args():
  - Added `init=/sbin/init root=/dev/vda rw` to kernel boot arguments
  - These parameters are required for the kernel to mount rootfs and run init
- Replaced OpenSSH with dropbear in rootfs/Dockerfile:
  - OpenSSH sshd caused init process to die when daemonizing (PID 1 issue)
  - Dropbear is lighter weight and works correctly in minimal VM environment
  - Pre-generates host keys during image build (RSA, ECDSA, ED25519)
- Added rng-tools package to rootfs/Dockerfile:
  - SSH was timing out during banner exchange due to uninitialized kernel RNG
  - rngd feeds entropy from /dev/urandom to /dev/random to initialize CRNG
- Complete rewrite of rootfs/init script:
  - Uses `mountpoint -q` to check if filesystems are already mounted (avoids errors)
  - Removed `set -e` to prevent init from dying on non-fatal errors
  - Starts rngd in background for entropy
  - Starts dropbear SSH server in foreground mode (`-R -F -E`)
  - Starts python3 HTTP server on port 8000 for testing
  - Improved logging to /var/log/init.log (also exposed via HTTP at /init.log)
- Tested full fcm workflow:
  - `fcm daemon` starts correctly, sets up fcm0 bridge
  - `fcm create` creates and starts VM
  - `fcm ls` lists running VMs with correct state
  - SSH works via `sshpass -p "root" ssh root@<vm-ip>`
  - `fcm stop`, `fcm start`, `fcm destroy` all work correctly
- All 69 tests pass
- Commit: c090b6c

### Task 14: Simplify fcm create with Better Defaults
- Removed --name CLI option - VMs now always get a random name (e.g., "cosmic-nova")
- Removed --expose CLI option - port 8000 is now always exposed by default
- Updated main.rs: simplified Create command with no arguments
- Updated client.rs: removed CreateVmRequest struct, simplified create_vm() function
- Updated daemon.rs: added DEFAULT_EXPOSE_PORT constant (8000), simplified handle_create_vm()
- Removed parse_json_body() function (no longer needed)
- Removed tests for CreateVmRequest serialization/deserialization
- Added test for DEFAULT_EXPOSE_PORT constant
- User experience is now simpler: just run `fcm create` with no options
- Random name is automatically used for the sslip.io domain
- All 66 tests pass
- Commit: 0c71ca5
- Fix: Domain now correctly uses VM name (e.g., nebula-tensor.64-34-93-45.sslip.io)
- Commit: 02a883b

### Task 15: Remove Unused Code to Eliminate Compiler Warnings
- Removed dead code across multiple modules to eliminate all 15 compiler warnings
- caddy.rs:
  - Removed ParseError variant from CaddyError enum
  - Removed is_running() function
  - Removed validate() and validate_file() functions
  - Updated test_caddy_error_display test
- firecracker.rs:
  - Removed InstanceInfo struct
  - Removed get() method
  - Removed get_instance_info() method
  - Removed test_instance_info_deserialization test
- network.rs:
  - Removed SUBNET_MASK and SUBNET_CIDR constants
  - Removed InvalidIp variant from NetworkError enum
  - Removed cleanup_network() function
  - Removed parse_last_octet() and is_valid_vm_ip() functions
  - Removed associated tests for deleted code
- vm.rs:
  - Removed load_by_id() method from VmConfig
  - Removed is_vm_running() function
  - Removed sync_vm_state() function
- All 59 tests pass with zero warnings
- Commit: c9bf4ad

### Task 16: Fix Clippy Warnings
- Fixed 3 clippy warnings for cleaner, more idiomatic Rust code
- client.rs: Embedded DOMAIN literal directly in format string instead of using `{}`
- daemon.rs: Removed useless `.into()` call for header.value.as_str() which already returns `&str`
- firecracker.rs: Replaced manual range check `status >= 200 && status < 300` with `(200..300).contains(&status)`
- All 59 tests pass with zero clippy warnings
- Commit: 733b018

### Task 17: SSH Public Key Injection for Passwordless VM Access
- Users with SSH keys can now SSH into VMs without entering a password
- client.rs:
  - Added find_ssh_public_key() to read user's SSH public key from ~/.ssh/
  - Tries id_ed25519.pub, id_ecdsa.pub, id_rsa.pub in order of preference
  - Sends key in CreateVmRequest JSON body when creating a VM
  - Shows warning if no SSH key found (password auth still works)
- daemon.rs:
  - Added CreateVmRequest struct with ssh_public_key field
  - Parses request body in handle_create_vm() and passes key to vm::create_vm()
- vm.rs:
  - Added inject_ssh_key() function that mounts rootfs and writes authorized_keys
  - Creates /root/.ssh directory with 700 permissions
  - Writes key to /root/.ssh/authorized_keys with 600 permissions
  - Updated create_vm() signature to accept optional ssh_public_key
  - Injects key after copying rootfs, before creating tap device
- All 61 tests pass with zero warnings
- Commit: 958aaa8

### Task 18: FCM_HOST Environment Variable for Remote Connections
- Added support for connecting to remote daemon via FCM_HOST env var
- client.rs:
  - Added daemon_url() function to get daemon URL from FCM_HOST or default
  - Supports both bare host:port (e.g., "192.168.1.100:7777") and full URLs
  - Automatically prepends "http://" if no scheme provided
  - Defaults to "http://127.0.0.1:7777" when FCM_HOST not set
  - Updated make_request() to use daemon_url() instead of hardcoded constant
  - Added 3 unit tests for daemon URL handling
- All 64 tests pass with zero warnings
- Commit: 4f12443

### Task 19: Bind Daemon to All Interfaces for External Access
- Changed BIND_ADDR from "127.0.0.1:7777" to "0.0.0.0:7777"
- Allows remote CLI clients to connect without SSH tunneling
- Token authentication still required for all requests
- Commit: e56a284

### Task 20: SSH ProxyJump for Remote Daemon Connections
- Fixed SSH failing when CLI runs on external machine (e.g., Mac connecting to remote server)
- Problem: `fcm ssh` tried to connect directly to VM's internal IP (172.16.0.x)
- Solution: Use SSH ProxyJump (-J) to tunnel through the daemon host
- client.rs:
  - Added get_jump_host() function to detect remote daemon and build jump host string
  - Extracts hostname from FCM_HOST (strips scheme and port)
  - Returns None for localhost/127.0.0.1 (no jump needed)
  - Uses current user ($USER) for jump host authentication
  - Updated ssh_vm() to add -J flag when connecting to remote daemon
  - Shows "Connecting via jump_host..." message for remote connections
  - Added 4 unit tests for get_jump_host() function
- All 68 tests pass with zero warnings
- Commit: a28be91

### Task 21: Session Management Module (session.rs)
- Created session.rs module for persistent console session management
- SessionError enum with Display impl for error handling:
  - NotFound, VmNotAvailable, SshError, TmuxError, Io variants
- SessionInfo struct for session metadata:
  - id: unique 6-char session ID
  - vm_id: VM the session belongs to
  - tmux_session: tmux session name (fcm-<id>)
  - created_at: creation timestamp
  - is_default: whether this is the default session for the VM
- SessionManager struct with thread-safe session tracking:
  - create_session(): creates tmux session on VM via SSH
  - get_session(): retrieves session info by ID
  - list_sessions(): lists all sessions for a VM
  - kill_session(): terminates tmux session on VM
  - remove_vm_sessions(): removes all sessions when VM is stopped/destroyed
  - sync_sessions(): syncs with actual tmux state on VM
- Helper functions:
  - generate_session_id(): generates 6-char alphanumeric IDs
  - create_tmux_session(): creates tmux session via SSH
  - list_tmux_sessions(): lists tmux sessions via SSH
  - kill_tmux_session(): kills tmux session via SSH
  - attach_to_session(): spawns SSH process attached to tmux session
- Added session module to main.rs
- 13 unit tests for session management functionality
- All 79 tests pass (single-threaded; 2 pre-existing test isolation issues with parallel env vars)
- Commit: b9eb527

### Task 22: Wire Session Endpoints to Daemon
- Wired session management endpoints to daemon HTTP server
- Added SessionResponse type for API responses (converts SessionInfo to JSON)
- Added CreateSessionRequest type with is_default field for session creation
- Imported session module into daemon.rs
- Created SessionManager instance in daemon's run() function
- Added three new handlers:
  - handle_create_session(): POST /vms/{id}/sessions - creates new tmux session
  - handle_list_sessions(): GET /vms/{id}/sessions - lists active sessions for a VM
  - handle_kill_session(): DELETE /vms/{id}/sessions/{session-id} - kills a session
- Refactored routing to use pattern matching on path parts (cleaner than if/else chains)
- Removed unused extract_vm_id() function (replaced by pattern matching)
- Updated tests: replaced test_extract_vm_id with test_session_response_from_info and test_create_session_request_default
- Removed module-level #![allow(dead_code)] from session.rs
- Added specific #[allow(dead_code)] attributes to items that will be used in future tasks
- All 80 tests pass with zero warnings
- Commit: 48a3093

### Task 23: Console Streaming Client Module (console.rs)
- Created console.rs module for client-side terminal streaming
- ConsoleError enum with variants: ConnectionFailed, AuthFailed, Io, TerminalError, SessionError
- ConnectRequest struct for authentication protocol:
  - vm: VM ID or name
  - session: session ID to connect to
  - token: auth token for daemon
- ConnectResponse struct for daemon response (success/error)
- terminal_host() function to extract hostname from FCM_HOST env var
- load_token() function to load auth token (FCM_TOKEN env or ~/.fcm-token)
- RawTerminal struct for terminal mode handling:
  - enable() puts terminal in raw mode using libc termios
  - restore() restores original terminal settings
  - Implements Drop trait for automatic cleanup
- is_tty() function to check if stdin is a terminal
- connect() main function:
  - Connects to daemon terminal server (port 7778)
  - Sends JSON authentication message
  - Reads response and validates success
  - Enters raw terminal mode
  - Spawns reader thread for socket->stdout proxying
  - Main thread handles stdin->socket proxying
  - Supports Ctrl+] (0x1d) to disconnect
  - Proper cleanup and terminal restoration on exit
- Added console module to main.rs
- Added #[allow(dead_code)] annotations for items used in future tasks
- 10 unit tests for serialization, deserialization, and helper functions
- All 89 tests pass with zero warnings
- Commit: 5d50657

### Task 24: Terminal Server on Port 7778 in Daemon
- Added terminal server TCP listener on port 7778 for persistent console sessions
- Terminal server runs in a separate thread alongside the HTTP server
- TerminalConnectRequest struct for client authentication protocol:
  - vm: VM ID or name
  - session: session ID to connect to
  - token: auth token for daemon
- TerminalConnectResponse struct for server responses (success/error)
- handle_terminal_connection() function:
  - Reads JSON connect request with newline delimiter
  - Validates auth token
  - Looks up VM and validates it's running
  - Looks up session and verifies it belongs to the VM
  - Spawns SSH process attached to tmux session using attach_to_session()
  - Sends success response, then proxies I/O
- send_terminal_error() and send_terminal_response() helpers
- proxy_terminal_io() function:
  - Spawns thread to read from child stdout and write to client
  - Main thread reads from client and writes to child stdin
  - Handles EOF and connection drops gracefully
- run_terminal_server() function:
  - Binds to 0.0.0.0:7778
  - Accepts connections in a loop
  - Spawns thread for each connection
- Updated daemon's run() to spawn terminal server thread
- 4 unit tests for terminal protocol types
- All 93 tests pass with zero warnings
- Commit: b1eaae8

### Task 25: Update CLI with console/sessions/attach Commands
- Added three new CLI commands in main.rs for persistent console sessions:
  - `fcm console <vm>` - opens persistent console session (creates default session)
  - `fcm sessions <vm>` - lists active sessions for a VM
  - `fcm attach <vm> <session-id>` - reattaches to an existing session
- Added client functions in client.rs:
  - console_vm() - creates session via POST /vms/{id}/sessions, then connects via console::connect()
  - list_sessions() - GET /vms/{id}/sessions with formatted table output
  - attach_session() - connects to existing session via console::connect()
- Added SessionResponse struct for deserializing session API responses
- Added format_timestamp() helper for human-readable relative times (e.g., "5m ago", "2h ago")
- Imported console module in client.rs for terminal streaming connection
- All 93 tests pass with zero warnings
- Commit: 2bdb7eb

### Task 26: Remove #[allow(dead_code)] Attributes from console.rs
- Removed 12 #[allow(dead_code)] annotations from console.rs
- Code is now used after Task 25 wired CLI commands
- Removed dead_code from:
  - DEFAULT_TERMINAL_PORT constant
  - ConsoleError enum
  - ConnectRequest struct
  - ConnectResponse struct
  - terminal_host() function
  - token_path() function
  - load_token() function
  - RawTerminal struct
  - RawTerminal::enable() method
  - RawTerminal::restore() method
  - is_tty() function
  - connect() function
- All 93 tests pass with zero warnings
- Commit: 21be38e
- Additional cleanup in session.rs:
  - Removed dead_code from get_session() - used in daemon.rs:550
  - Removed dead_code from attach_to_session() - used in daemon.rs:571
  - Updated comments on VmNotAvailable and SshError variants (still unused)
- Remaining legitimate dead_code annotations:
  - client.rs: vm_id field in SessionResponse (JSON completeness, not displayed)
  - session.rs: VmNotAvailable variant (matched but not constructed)
  - session.rs: SshError variant (matched but not constructed)
- Commit: cfb609d

### Task 27: Wire Session Cleanup to VM Stop/Destroy
- Sessions are now automatically cleaned up when a VM is stopped or destroyed
- Updated handle_stop_vm() in daemon.rs:
  - Added session_manager parameter
  - Calls remove_vm_sessions() after successfully stopping VM
- Updated handle_destroy_vm() in daemon.rs:
  - Added session_manager parameter
  - Calls remove_vm_sessions() after successfully destroying VM
- Updated routing in handle_request() to pass session_manager to:
  - handle_stop_vm() for POST /vms/{id}/stop
  - handle_destroy_vm() for DELETE /vms/{id}
- Removed #[allow(dead_code)] from remove_vm_sessions() in session.rs
- All 93 tests pass with zero warnings
- Commit: a1099a5

### Task 28: Fix Session SSH Authentication with sshpass
- Fixed session management SSH commands to use sshpass for password authentication
- The daemon uses SSH to create/list/kill tmux sessions on VMs
- VMs use root:root password auth, but session.rs was using plain ssh without credentials
- Updated all SSH functions in session.rs to use sshpass:
  - create_tmux_session(): creates tmux session on VM
  - list_tmux_sessions(): lists active tmux sessions on VM
  - kill_tmux_session(): terminates tmux session on VM
  - attach_to_session(): spawns SSH process attached to tmux session
- Fixed sync_sessions() bug:
  - Previously used unwrap_or_default() which returned empty Vec on SSH error
  - This caused all sessions to be removed when SSH temporarily failed
  - Now skips sync entirely if list_tmux_sessions() fails (preserves existing sessions)
- Tested all console commands:
  - `fcm sessions <vm>` - lists active sessions correctly
  - `fcm console <vm>` - creates session and connects (non-TTY error expected in test)
  - `fcm attach <vm> <session-id>` - attaches to existing session
- All 93 tests pass with zero warnings
- Commit: d78521c

### Task 29: Remove Legacy SSH Command (Not in PRD)
- The PRD specifies console/sessions/attach commands for VM access, not a bare ssh command
- With persistent console sessions fully implemented, the legacy ssh command is no longer needed
- main.rs:
  - Removed Ssh variant from Commands enum
  - Removed Commands::Ssh match arm
- client.rs:
  - Removed ssh_vm() function
  - Removed get_jump_host() function (only used by ssh_vm)
  - Removed SshInfoResponse struct
  - Removed std::process::Command import
  - Removed 5 related tests (ssh_info_deserialization, 4 get_jump_host tests)
- daemon.rs:
  - Removed SshInfoResponse struct
  - Removed handle_ssh_info() function
  - Removed /vms/{id}/ssh route from routing table
- All 88 tests pass with zero warnings
- Commit: 0a44c31

### Task 30: Add tmux to Base Rootfs Image
- PRD specifies tmux for persistent console sessions, but it was missing from Dockerfile
- rootfs/Dockerfile:
  - Added tmux to apk add package list
- Rebuilt base-rootfs.img with tmux included (145MB sparse)
- Tested with new VM (orbital-comet):
  - `fcm sessions` - correctly shows no sessions initially
  - `fcm console` - creates session successfully, connects to terminal server
  - `fcm attach` - attaches to existing session correctly
  - tmux session persists on VM (verified via direct SSH)
- All 88 tests pass with zero warnings
- Commit: e71ea59

### Task 31: macOS Cross-Compilation Script
- Created build-macos.sh script for cross-compiling fcm CLI to macOS
- Uses cargo-zigbuild with Zig as cross-linker (no macOS SDK required)
- Builds two targets:
  - aarch64-apple-darwin (Apple Silicon M1/M2/M3) - 2.5MB binary
  - x86_64-apple-darwin (Intel Mac) - 2.6MB binary
- Prerequisites: `cargo install cargo-zigbuild`, zig installed
- Usage: `./build-macos.sh`
- Outputs to target/<arch>-apple-darwin/release/fcm
- All 88 tests pass with zero warnings
- Commit: a87f4fc

## Next Tasks
- None - all PRD features implemented
